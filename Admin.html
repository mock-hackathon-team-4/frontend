<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Admin Page</title>
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
        <script src='https://kit.fontawesome.com/a076d05399.js'></script>

        <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase.js"></script>
        <script>
            var firebaseConfig = {
                apiKey: "AIzaSyBrePrVL7CuPjjnbe8xNGmeg0I8UHP1izs",
                authDomain: "first-web-e0fb1.firebaseapp.com",
                databaseURL: "https://first-web-e0fb1.firebaseio.com",
                projectId: "first-web-e0fb1",
                storageBucket: "first-web-e0fb1.appspot.com",
                messagingSenderId: "879234316989",
                appId: "1:879234316989:web:f1e6215e2c8c7cbd4115d4"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
        </script>
        <style>
            .container{
                margin-top: 50px;
               
                margin-bottom: 50px;
            }
            .header{
                padding: 30px;
                background-color: cadetblue;
                text-align: center;
                border-radius: 10px;
                color: white;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>NGO Admin Page</h1>
            </div>
            
        </div>
   
    <!-- modal-->
    <!--<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#edithero">
        Edit 
    </button>-->
    <div class="modal" id="edithero" tabindex="-1" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Edit Hero</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                  <form>
                      <input type="hidden" class="form-control" id="heroid">
                         <div class="form-group">
                         <label for="editinputheroname">Hero Name</label>
                         <input type="text" class="form-control" id="editinputheroname" aria-describedby="emailHelp" placeholder="Hero name">
                         
                         </div>
                         <div class="form-group">
                             <label for="hero-race">Hero race</label>
                             <select class="form-control" name="hero-race" id="edit-hero-race">
                                 <option value="volvo">Volvo</option>
                                 <option value="saab">Saab</option>
                                 <option value="mercedes">Mercedes</option>
                                 <option value="audi">Audi</option>
                               </select>
                         </div>
                         <div class="form-group">
                             <label for="hero-profession">Hero profession</label>
                             <select class="form-control" name="hero-profession" id="edithero-profession">
                                 <option value="Doctor">Doctor</option>
                                 <option value="Engineer">Engineer</option>
                                 <option value="CEO">CEO</option>
                                 <option value="Designer">Designer</option>
                               </select>
                         </div>
                         <div class="form-group" >
                             <label for="hero-strength">Hero Strength: <span class="attrib-value">0</span></label><br>
                             <input class="form-control hero-sss custom-range" type="range" name="hero-strength" id="edithero-strength" min="1" max="100" value="1">
                         </div>
                         <div class="form-group" >
                             <label for="hero-speed">Hero Speed: <span class="attrib-value">0</span></label><br>
                             <input class="form-control hero-sss custom-range" type="range" name="hero-speed" id="edithero-speed" min="1" max="100" value="1">
                         </div>
                         <div class="form-group" >
                             <label for="hero-stamina">Hero Stamina: <span class="attrib-value">0</span></label><br>
                             <input class="form-control  hero-sss custom-range" type="range" name="hero-stamina" id="edithero-stamina" min="1" max="100" value="1">
                         </div>
                         <div class="checkbox">
                             <label>
                                 <input id="editid-diety" type="checkbox"> Is Diety
                             </label>
                         </div>
                        </form>
                   
               

            </div>
            <div class="modal-footer">
                
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button id="edit-hero-button"type="button" class="btn btn-primary">Update changes</button>
            </div>
          </div>
        </div>
      </div>
      <!-- login-->
        <div class="container" id="login-form">
            <h1>Log In Or Create Account</h1>
            
            <button style='font-size:24px;float: right;border-radius: 50%;border-color: black;'><i class='fas fa-user'></i></button>
            <p style="float: right;" id="usericon"></p>
            <div class="jumbotron">
                
                <form>
                    <div class="form-group">
                    <label for="inputemail">Email </label>
                    <input type="email" class="form-control" id="inputemail" aria-describedby="emailHelp" placeholder="Enter email">
                    
                    </div>
                    <div class="form-group">
                    <label for="inputpasswd">Password</label>
                    <input type="password" class="form-control" id="inputpasswd" placeholder="Password">
                    </div>
                    
                    <button id="sign-in-button" type="button" class="btn btn-primary btn-block">Sign In</button>
                    <button id="create-user-button" type="button" class="btn btn-warning btn-block">Create Account</button>
                    <button id="google-login-button" type="button" class="btn btn-primary btn-block">Sign In with Google</button>
                    

                </form>
            </div>
        </div>
        
           
            <div class="container">
                <hr>
                <button id="logout-button"  style="width :100px;float:right;" type="button" class="btn btn-danger btn-block">Log Out</button>
               
            </div>
         
           <div class="container" id="views">
            
            
             </div>
           <div class="container" id="show-hero">
               <h1>Show heroes</h1>
           </div>
     
          
          <div class="container" id="add-hero">
            <h1>Create Hero</h1>
            <div class="jumbotron">
                <form>
                    <div class="form-group">
                    <label for="inputheroname">Hero Name</label>
                    <input type="text" class="form-control" id="inputheroname" aria-describedby="emailHelp" placeholder="Hero name">
                    
                    </div>
                    <div class="form-group">
                        <label for="hero-race">Hero race</label>
                        <select class="form-control" name="hero-race" id="hero-race">
                            <option value="volvo">Volvo</option>
                            <option value="saab">Saab</option>
                            <option value="mercedes">Mercedes</option>
                            <option value="audi">Audi</option>
                          </select>
                    </div>
                    <div class="form-group">
                        <label for="hero-profession">Hero profession</label>
                        <select class="form-control" name="hero-profession" id="hero-profession">
                            <option value="Doctor">Doctor</option>
                            <option value="Engineer">Engineer</option>
                            <option value="CEO">CEO</option>
                            <option value="Designer">Designer</option>
                          </select>
                    </div>
                    <div class="form-group" >
                        <label for="hero-strength">Hero Strength: <span class="attrib-value">0</span></label><br>
                        <input class="form-control hero-sss custom-range" type="range" name="hero-strength" id="hero-strength" min="1" max="100" value="1">
                    </div>
                    <div class="form-group" >
                        <label for="hero-speed">Hero Speed: <span class="attrib-value">0</span></label><br>
                        <input class="form-control hero-sss custom-range" type="range" name="hero-speed" id="hero-speed" min="1" max="100" value="1">
                    </div>
                    <div class="form-group" >
                        <label for="hero-stamina">Hero Stamina: <span class="attrib-value">0</span></label><br>
                        <input class="form-control  hero-sss custom-range" type="range" name="hero-stamina" id="hero-stamina" min="1" max="100" value="1">
                    </div>
                    <div class="checkbox">
                        <label>
                            <input id="id-diety" type="checkbox"> Is Diety
                        </label>
                    </div>

                    <button id="create-newhero-button" type="button" class="btn btn-primary btn-block">Create New Hero</button>
                   

                </form>
            </div>
        </div>
        <script>
            var currentuser={};
            $('#create-user-button').click(function(){
                var email=$("#inputemail").val();
                var password=$("#inputpasswd").val();
                console.log("user= " +email+ " "+ password);
                CreateUser(email,password);
            });
            $('#sign-in-button').click(function(){
                var email=$("#inputemail").val();
                var password=$("#inputpasswd").val();
                console.log("existinguser= " +email+ " "+ password);
                SignIn(email,password);
                $("#usericon").text(email);
            });
            $('#logout-button').click(function(){
                firebase.auth().signOut();
                console.log("loged out");
                $("#usericon").text(" ");
                $("#login-form").show();
                    $("#add-hero").hide();
              
            });
            function CreateUser(email,password)
            {

                
                firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    // ...
                    });
            }
            function writeUserData(user) {
                firebase.database().ref('users/' + user.uid).set({
                    
                    email: user.email
                    
                });
            }
            function SignIn(email,password){
            firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
                                // Handle Errors here.
                                var errorCode = error.code;
                                var errorMessage = error.message;
                                // ...
                    });
            }
           $("#google-login-button").click(function(){
                var provider = new firebase.auth.GoogleAuthProvider();
                firebase.auth().signInWithPopup(provider).then(function(result) {
                // This gives you a Google Access Token. You can use it to access the Google API.
                var token = result.credential.accessToken;
                // The signed-in user info.
                 currentuser = result.user;
                 $("#usericon").text(currentuser);
                // ...
                }).catch(function(error) {
                // Handle Errors here.
               
                var errorMessage = error.message;
                alert(errorMessage);
                // The email of the user's account used.
                var email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                var credential = error.credential;
                // ...
                });

        });
            var heroref=firebase.database().ref().child("heroes");
            heroref.on("value",function(snapshot){
                $("#show-hero").empty();
                var heroHtml="<h3>Events</h3>";
                snapshot.forEach(function(childsnapshot){
                    var person=childsnapshot.val();
                    heroHtml+="<div class 'heroHtml'<hr><ul>";
                    heroHtml+="<li>Name:<span class='hero-data-name'>"+ person.name+"</span> </li>";
                    heroHtml+="<li>Race:<span class='hero-data-race'>"+ person.race+"</span> </li>";
                    heroHtml+="<li>Profession:<span class='hero-data-profession'>"+ person.profession+"</span> </li>";
                    heroHtml+="<li>Strength:<span class='hero-data-strength'>"+ person.strength+"</span> </li>";
                    heroHtml+="<li>Stamina:<span class='hero-data-stamina'>"+ person.stamina+"</span> </li>";
                    heroHtml+="<li>Is diety:<span class='hero-data-diety'>"+ person.diety+"</span> </li>";
                    heroHtml+="</ul>";
                    heroHtml+=" <button type='button' class='btn btn-danger delete-hero' id="+ person.id+">Delete</button>";
                    heroHtml+=" <button type='button' class='btn btn-primary edit-hero-button' data-heroid='"+person.id+"' data-toggle='modal' data-target='#edithero'>Edit</button>";
                    heroHtml+=" <button type='button' class='btn btn-success view-hero' id="+ person.name+">View Applications</button>";
                    heroHtml+="</div>";
                });
                $("#show-hero").html(heroHtml);
            });
            $(document).on("click",".view-hero",function(){
               
                var heroid=$(this).attr('id');

                
                var viewref=firebase.database().ref("events/"+heroid);
                viewref.on("value",function(snapshot){
                    $("#views").empty();
                    viewHtml="<h3>"+heroid+" Requests</h3>";
                    
                    snapshot.forEach(function(childsnapshot){
                        var w=childsnapshot.val();
                        console.log(w);
                        viewHtml+=w;
                        viewHtml+="<button type='button' style='margin:10px' class='btn btn-success accept-hero' id="+w+">Accept</button>";
                        viewHtml+="<button type='button' style='margin:10px' class='btn btn-danger reject-hero'>Delete</button>";
                        viewHtml+="<br>";

                    });
                    $("#views").html(viewHtml);
                });
            });
            $(document).on("click",".accept-hero",function(){
                var volid=$(this).attr('id');
                console.log(volid);


            });
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in.
                   
                    var email = user.email;
                    currentuser=user;
                    writeUserData(user);
                     
                    $("#login-form").hide();
                    $("#add-hero").show();
                    
                } 
                else {
                    // User is signed out.
                    // ...
                }
            });
            $('#create-newhero-button').click(function(){
                var hero={
                    id: $("#inputheroname").val()+ Date.now(),
                    Owner: currentuser.uid,
                    name: $("#inputheroname").val(),
                    race: $("#hero-race option:selected").text(),
                    profession: $("#hero-profession option:selected").text(),
                    strength: $("#hero-strength").val(),
                    speed: $("#hero-speed").val(),
                    stamina: $("#hero-stamina").val(),
                    diety: $("#id-diety").prop("checked")
                    };
                    addherodata(hero)
            });
          
            $('#edit-hero-button').click(function(){
                var hero={
                    id: $("#heroid").val(),
                    Owner: currentuser.uid,
                    name: $("#editinputheroname").val(),
                    race: $("#edit-hero-race option:selected").text(),
                    profession: $("#edithero-profession option:selected").text(),
                    strength: $("#edithero-strength").val(),
                    speed: $("#edithero-speed").val(),
                    stamina: $("#edithero-stamina").val(),
                    diety: $("#editid-diety").prop("checked")
                    };
                    console.log(hero);
                    console.log("updated");
                    addherodata(hero)
            });
            $(document).on("click",".delete-hero",function(){
                var heroid=$(this).attr('id');
                firebase.database().ref("heroes/"+heroid).remove();
                firebase.database().ref("users/" +currentuser.uid+ "heroes/"+heroid).remove();
            });


            $(document).on("click",".edit-hero-button",function(){
                var heroid=$(this).attr("data-heroid");
                console.log("click" +heroid);
                $("#heroid").val(heroid);

               var heroname= $(this).parent().find('.hero-data-name').text();
               $("#editinputheroname").val(heroname);

               var race= $(this).parent().find('.hero-data-race').text();
               race=race.toLowerCase();
               $("#edit-hero-race").val(race).change();
               

               var heroprof= $(this).parent().find('.hero-data-profession').text();
               $("#edithero-profession").val(heroprof).change();

               

              
               var herostregth= $(this).parent().find('.hero-data-strength').text();
               $("#edithero-strength").val(herostregth).change();

               var herosped= $(this).parent().find('.hero-data-speed').text();
               $("#edithero-speed").val(herosped).change();

               var herostam= $(this).parent().find('.hero-data-stamina').text();
               $("#edithero-stamina").val(herostam).change();

               var herodiety= $(this).parent().find('.hero-data-diety').text();
               if(herodiety=="true")
                    $("#editid-diety").attr("checked",true);
                else
                $("#editid-diety").attr("checked",false);
            });

            $(".hero-sss").on("change",function(){
                var currentvalue=$(this).val();
                $(this).parent().find("span").text(currentvalue);
            });


            function addherodata(h)
            {
                var database=firebase.database();
                
                firebase.database().ref("events/"+h.name).set(" ");
                firebase.database().ref("heroes/" +h.id).set(h);
                firebase.database().ref("users/" +currentuser.uid+ "/heroes/" + h.id).set(h);
                    
                    
                    
                
            }
        </script>
    </body>
</html>
